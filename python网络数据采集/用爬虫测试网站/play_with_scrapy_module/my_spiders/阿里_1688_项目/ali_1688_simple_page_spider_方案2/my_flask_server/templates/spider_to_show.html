<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>甄优爬虫</title>
		<link rel="stylesheet" type="text/css" href="../static/css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../static/css/swiper-3.4.2.min.css"/>
    <style type="text/css">
			html,
			body {
			  width: 100%;
			  font-size: .16rem;
			  color: #333333;
			}
			html {
			  font-size: 100px;
			}    	
       header{
        width:100%;
        height:.8rem;
        background: #dfdfdf;
      }
      .main{
      	width: 12rem;
      	height: 10rem;
      	margin: 0 auto;
      }   	
	.collect-info{
		width: 100%;
		height: 2.34rem;
	}
	.title{
		height: .44rem;
		text-align: center;
		line-height: .44rem;
	}
	.grab{
		width: 10rem;
		height: .5rem;
		margin: 0 auto;
		display: flex;
		border: 1px solid #ebebeb;
	}
	.grab a{
		display: block;
		flex: 1;
		height: .5rem;
		text-align: center;
		line-height: .5rem;
	}
	.grab .active{
		color: black;
	}
	.goodsLink{
		width: 8rem;
		height: .4rem;
		margin: .2rem auto;
	}
	.goodsLink input{
		width: 8rem;
		height: .4rem;	
		border: 1px solid #ebebeb;
		border-radius: .08rem;
		text-indent: 10px;
	}
	.collect-btn{
		width: 8rem;
		height: .3rem;
		margin: 0 auto;
		display: flex;
	}
	.collect-btn a{
		display: block;
		flex: 1;
		text-align: center;
	}
	.collect-content{
		width: 100%;
		height: 5.7rem;
		
	}
	.goodsName{
		width: 100%;
		height: .36rem;
	}
	.collect-main{
		width: 100%;
	}
	.collect-main-left{
		width: 4rem;
		height: 5.26rem;
		float: left;
	}
	.bigGoods{
		width: 4rem;
		height: 4rem;
		margin-bottom: .15rem;
		background: #efaf85;
	}
	.bigGoods img{
		width: 100%;
		height: 100%;
	}	
	.smallGoodsList{
		width: 4rem;
		height: .6rem;
		position: relative;		
    overflow: hidden;			
	}
	.smallGoodsList ul{
		width: 4rem;
		height: .6rem;
	}
	.smallGoodsList ul li{
		width: .6rem !important;
		height: .6rem;
		margin-right: .24rem;
		cursor: pointer;
	}
	.smallGoodsList ul li:last-child{
		margin: 0;
	}
	.smallGoodsList ul li img{
		width: 100%;
		height: 100%;
	}	
	.btn-left{
		display: block;
		width: .24rem;
		height: .6rem;
		position: absolute;
		left: 0;
		top: 0;
		background: url(../static/images/btn-l.png)no-repeat center;
		background-size: 100% auto;
		background-color: #ffffff;
		z-index: 20;
	}
	.btn-right{
		display: block;
		width: .24rem;
		height: .6rem;		
		position: absolute; 
		right: 0;
		top: 0;
		background: url(../static/images/btn-r.png)no-repeat center;
		background-size: 100% auto;
		background-color: #ffffff;
		z-index: 20;			
	}
	.seller-info{
		padding-top: .2rem;
	}
	.seller-info input{
		width: 1.1rem;
		height: .3rem;
		border: 1px solid #CCCCCC;
	}
	.collect-main-right{
		float: left;
		width: 7.48rem;
		height: 5.26rem;
		margin-left: .2rem;		
	}
	.goods-info{
		width: 100%;
		height: 1.5rem;
		background: #ebcebb;
		border-top: 2px solid #e72d44;
	}
	.price,.number{
		text-align: center;
		height: .75rem;
		line-height: .75rem;
	}
	.price ul,.number ul{	
		display: flex;
	}
	.price ul li,.number ul li{
		color: #e72d44;
		font-size: .3rem;	
		flex: 1;	
	}
	.price ul li:first-child,.number ul li{
		color: #333333;
		font-size: .16rem;
	}
	.goodsColor{
		width: 100%;
		height: .6rem;
		border-bottom: 1px solid #CCCCCC;
	}
	.goodsColor-left,.goodsSize-left{
		width: 1rem;
		text-align: center;
		line-height: .6rem;
		float: left;
	}
	.goodsColor-right{
		width: 6.48rem;
		height: .6rem;
		float: left;
	}
	.goodsColor-right ul li{
		width: .3rem;
		height: .3rem;
		line-height: .3rem;
		margin: .15rem .3rem;
		float: left;
		white-space: nowrap;
	}
	.goodsColor-right ul li img{
		width: 100%;
		height: 100%;
	}
	.goodsColor-right ul .active{
		border: 1px solid #e72d44;
	}
	.goodsColorImg{
		width: .4rem;
    height: .4rem;
    margin: 0 auto;
    display: block;	
	}
	.goodsSize{
		width: 7.48rem;
		height: 1.22rem;
	}
	.goodsSize-right{
		width: 6.48rem;
		height: 1.22rem;
		float: left;
	}
	.goodsSize-right>ul{
		width: 6.48rem;
		height: 1.22rem;		
	}
	.goodsSize-right>ul li{
		width: 6.48rem;
		height: .4rem;	
		border-bottom: 1px solid #CCCCCC;	
	}
	.goodsSize-right>ul li ul{
		width: 6.48rem;
		height: .4rem;		
		display: flex;
	}	
	.goodsSize-right>ul li ul li{
		flex: 1;
		line-height: .4rem;
    white-space: nowrap;
    overflow: hidden;
    margin-right: .3rem;		
	}	
	.goodsSize-right>ul li ul li:hover{
		
	}		
	.wLink{
		width: 100%;
		height: 100%;
		text-align: center;
		color: red;
	}
	.mask{
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(0,0,0,.4);
	}
	.mask img{
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		margin: auto;
		width: 100px;
		height: 100px;		
	}
    </style>
  </head>
  <body>
    <header></header>
    <div class="main">
			<div class="collect-info">
				<div class="title">阿里巴巴商品采集</div>
				<div class="grab"><a class="active" href="javascript:" id="singleGrab">单个抓取</a><a href="javascript:" id="batchGrab">批量抓取</a></div>
				<div class="goodsLink">
					<input type="" name="" id="goodsLink" value="" placeholder="商品详情链接"/>
					<div class="wLink"></div>
				</div>
				<div class="collect-btn"><a href="javascript:" id="reset">重置</a><a href="javascript:" id="grab">抓取数据</a></div>
			</div>
			<div class="collect-content">
				<!--<div class="goodsName">5663实拍2017羽绒服女网红店主风面包服短款休闲夹克棉服衣女外套</div>
				<div class="collect-main">
					<div class="collect-main-left">
						 <div class="bigGoods"></div>
						 <div class="smallGoodsList">
						 	<ul>
						 		<li><a href=""></a></li>
						 		<li><a href=""></a></li>
						 		<li><a href=""></a></li>
						 		<li><a href=""></a></li>
						 		<li><a href=""></a></li>
						 	</ul>
						 	<a href="" class="btn-left"></a>
						 	<a href="" class="btn-right"></a>
						 </div>
						 <div class="seller-info">
						 	商铺名称  <input type="text" name="" id="" value=""/>
						 	旺旺账号  <input type="text" name="" id="" value=""/>
						 </div>
					</div>
					<div class="collect-main-right">
						<div class="goods-info">
							<div class="price">
								<ul>
									<li>价格</li>
									<li>¥ 119.00</li>
									<li>¥ 101.15</li>
									<li>¥ 89.25</li>
								</ul>
							</div>
							<div class="number">
								<ul>
									<li>起批量</li>
									<li> <span id="">3-9 </span>件</li>
									<li> <span id="">10-99 </span> 件</li>
									<li>≥ 件</li>
								</ul>
							</div>
						</div>
						<div class="goodsColor">
							<div class="goodsColor-left">颜色</div>
							<div class="goodsColor-right">
								<ul>
									<li class="active white"></li>
									<li class="gray"></li>
									<li class="black"></li>
								</ul>							
							</div>
						</div>
						<div class="goodsSize">
							<div class="goodsSize-left">尺寸</div>
							<div class="goodsSize-right">
								<ul>
									<li>
										<ul>
											<li>L</li>
											<li><span>119.00</span>元</li>
											<li><span id="">2000</span>件可售</li>
										</ul>
									</li>
									<li>
										<ul>
											<li>XL</li>
											<li><span>119.00</span>元</li>
											<li><span id="">2000</span>件可售</li>
										</ul>									
									</li>
									<li>
										<ul>
											<li>2XL</li>
											<li><span>119.00</span>元</li>
											<li><span id="">2000</span>件可售</li>
										</ul>									
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>-->
			</div>
			<div class="mask"><img src="../static/images/5-121204193Q9.gif"/></div>
    </div>
    <script src="../static/js/jquery-2.0.0.min.js" type="text/javascript" charset="utf-8"></script>  
    <script src="../static/js/ejs.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/js/swiper-3.4.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script  type="text/template" charset="utf-8" id="template">			
			<div class="goodsName"><%=goodsInfo.title%></div>
			<div class="collect-main">
				<div class="collect-main-left">
					 <div class="bigGoods" id="bigImg"><img src="<%=goodsInfo.center_img_url%>"/></div>
					 <div class="smallGoodsList swiper-container swiper-container-horizontal">
					 	<ul id="smallImg" class="swiper-wrapper">
					 		<%for(var i=0;i<goodsInfo.all_img_url.length;i++){%>
					 			<li class="smallImgList swiper-slide"><img src="<%=goodsInfo.all_img_url[i]%>"/></li>
					 		<% }%>
					 	</ul>
					 	<a href="" class="btn-left swiper-button-next"></a>
					 	<a href="" class="btn-right swiper-button-prev"></a>
					 </div>
					 <div class="seller-info">
					 	商铺  <input type="text" name="" id="" value=""/>
					 	旺旺  <input type="text" name="" id="" value=""/>
					 </div>
				</div>
				<div class="collect-main-right">
					<div class="goods-info">
						<div class="price">
							<ul >
								<li>价格</li>
								<%for(var i=0;i<goodsInfo.price.length;i++){%>
									<li><%=goodsInfo.price[i]%></li>
								<%}%>
							</ul>
						</div>
						<div class="number">
							<ul>
								<li>起批量</li>
								<%for(var i=0;i<goodsInfo.trade_number.length;i++){%>
								<li> <span id=""><%=goodsInfo.trade_number[i]%></span>件</li>
								<%}%>
							</ul>
						</div>
					</div>
					<% if(goodsInfo.size_info.length == 0){%>
						<div class="goodsSize">
							<div class="goodsSize-left">颜色</div>
							<div class="goodsSize-right">
								<ul>
									<%for(var i=0;i<goodsInfo.color.length;i++){%>
										<li>
											<ul>
												<li class="goodsColorList" title="<%=goodsInfo.color[i]%>"><img class="goodsColorImg" src="<%=goodsInfo.color_img_url[i]%>"/></li>
												<li title="<%=goodsInfo.detail_price[i]%>"><span><%=goodsInfo.detail_price[i]%></span>元</li>
												<li title="<%=goodsInfo.rest_number[i]%>"><span id=""><%=goodsInfo.rest_number[i]%></span>件可售</li>
											</ul>
										</li>									
									<%}%>
								</ul>
							</div>
						</div>						
					<%}else{%>	
						<div class="goodsColor">
							<div class="goodsColor-left">颜色</div>
							<div class="goodsColor-right">
								<ul>
										<%if(goodsInfo.color_img_url ==''){%>
											<%for(var i=0;i<goodsInfo.color.length;i++){%>
												<li ><%=goodsInfo.color[i]%></li>
											<%}%>	
										<%}else{%>
											<%for(var i=0;i<goodsInfo.color_img_url.length;i++){%>
												<li class="goodsColorList"><img src="<%=goodsInfo.color_img_url[i]%>"/></li>
											<%}%>	
									<%}%>	
								</ul>							
							</div>
						</div>
						<div class="goodsSize">
							<div class="goodsSize-left">尺寸</div>
							<div class="goodsSize-right">
								<ul>
									<%for(var i=0;i<goodsInfo.size_info.length;i++){%>
										<li>
											<ul>
												<li title="<%=goodsInfo.size_info[i]%>"><%=goodsInfo.size_info[i]%></li>
												<li title="<%=goodsInfo.detail_price[i]%>"><span><%=goodsInfo.detail_price[i]%></span>元</li>
												<li title="<%=goodsInfo.rest_number[i]%>"><span id=""><%=goodsInfo.rest_number[i]%></span>件可售</li>
											</ul>
										</li>									
									<%}%>
								</ul>
							</div>
						</div>						
					<% }%>

				</div>
			</div>
		</script>    
    <script type="text/javascript">
	/*REM*/
		~function(){
			var desW = 1920,
				winW = document.documentElement.clientWidth||document.body.clientWidth;				
				document.documentElement.style.fontSize = winW / desW * 100 + 'px';
		}();

	//	bindHTML
		
		var GoodsInfo = (function(){
			var $goodsInfoTemplate = $('#template'),
					$goodsInfo = $('.collect-content');
			
				function bindHTML(goodsInfo){
					var template = $goodsInfoTemplate.html();
					$goodsInfo.html(ejs.render(template,{goodsInfo:goodsInfo}));
	//swiper
		var swiper = new Swiper('.swiper-container', {
		      slidesPerView :'auto',
		        nextButton: '.swiper-button-next',
		        prevButton: '.swiper-button-prev',
		        offsetSlidesAfter:1
		    });			
	//carousel切换图片

				var bigImg = $('#bigImg'),
						bigImgPic = bigImg.children('img')[0];
						smallImg = $('#smallImg'),
						smallImgList = $('.smallImgList'),
						goodsColorList = $('.goodsColorList'),
						now = null;
	//点击小图切换					
						for(var i=0;i<smallImgList.length;i++){
							smallImgList[i].index = i;
							smallImgList[i].addEventListener('click',function(e){
								bigImgPic.src = e.target.src;
							})							
						}
	//点击颜色图切换
						for(var i=0;i<goodsColorList.length;i++){
							goodsColorList[i].index = i;
							goodsColorList[i].addEventListener('click',function(e){
								if(e.target.src){
									bigImgPic.src = e.target.src;	
								}else{
									return
								}
							
							})							
						}						
				}
			
				return {
					init:function(data){	
								bindHTML(data);							
					}
				}
			
		})()
		
//重置数据
		function reset(){
			$('#goodsLink').val('');
			$('#goodsLink').focus();
		}	
		$('#reset').click(function(){reset()});

//抓取数据
		
		$('#grab').click(function(){
			if($('#goodsLink').val()==''){
				return
			}
//弹出加载层
			$('.mask').show();
			$.ajax({
				type:"post",
//				url:$('#goodsLink').val(),
              	url:'/data',
				async:true,
				data:{
					goodsLink:$('#goodsLink').val()
				},
				success:function(data){
        			data = JSON.parse(data);
					if(data && data.reason == 'success'){
						console.log('1');
						setTimeout(function(){
							$('.mask').hide();
							GoodsInfo.init(data.data);
						}, 500)
					}else{
						reset();
						$('.wLink').text('您输入的网址有误，请重新输入！或者 登陆的账户已过期，请重新登录！');
						setTimeout(function(){
							$('.mask').hide();
						},500);
						setTimeout(function(){
							$('.wLink').text('')
						},3000)
					}
				},
				error:function (){
						reset();
						$('.wLink').text('您输入的网址有误，请重新输入！或者 登陆的账户已过期，请重新登录！');
						setTimeout(function(){
							$('.mask').hide();
						},500);
						setTimeout(function(){
							$('.wLink').text('')
						},3000)					
				}
			});
		})
    </script>
  </body>
</html>
